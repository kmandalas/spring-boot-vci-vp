<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Consent Required</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <style>
        body {
            background-color: #f5f5f5;
        }
        .consent-container {
            max-width: 500px;
            margin: 50px auto;
        }
        .scope-item {
            border-left: 3px solid #0d6efd;
            padding-left: 15px;
            margin-bottom: 15px;
        }
        .scope-name {
            font-weight: 600;
            color: #212529;
        }
        .scope-description {
            color: #6c757d;
            font-size: 0.9rem;
        }
    </style>
    <script>
        function cancelConsent() {
            document.getElementById('consent_form').reset();
            document.getElementById('consent_form').submit();
        }
    </script>
</head>
<body>
<div class="container consent-container">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Authorization Request</h4>
        </div>
        <div class="card-body">
            <p class="text-muted">
                The application <strong th:text="${clientId}">Client</strong> wants to access your account
                <strong th:text="${principalName}">User</strong>.
            </p>

            <div th:if="${userCode}" class="alert alert-info">
                <small>You have provided the code <strong th:text="${userCode}">code</strong>.
                    Verify that this code matches what is shown on your device.</small>
            </div>

            <hr>

            <h6 class="text-uppercase text-muted mb-3">Permissions Requested</h6>

            <form id="consent_form" method="post" th:action="${requestURI}">
                <input type="hidden" name="client_id" th:value="${clientId}">
                <input type="hidden" name="state" th:value="${state}">
                <input th:if="${userCode}" type="hidden" name="user_code" th:value="${userCode}">

                <div th:each="scope : ${scopes}" class="scope-item">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                               th:name="scope" th:id="${scope.scope}" th:value="${scope.scope}" checked>
                        <label class="form-check-label scope-name" th:for="${scope.scope}" th:text="${scope.scope}">
                            scope
                        </label>
                    </div>
                    <p class="scope-description mb-0" th:text="${scope.description}">Description</p>
                </div>

                <div th:each="scope : ${previouslyApprovedScopes}" class="scope-item">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox"
                               th:id="${scope.scope}" th:value="${scope.scope}" checked disabled>
                        <label class="form-check-label scope-name" th:for="${scope.scope}" th:text="${scope.scope}">
                            scope
                        </label>
                        <span class="badge bg-success ms-2">Previously Approved</span>
                    </div>
                    <p class="scope-description mb-0" th:text="${scope.description}">Description</p>
                </div>

                <hr>

                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                    <button type="button" class="btn btn-outline-secondary me-md-2" onclick="cancelConsent()">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Authorize
                    </button>
                </div>
            </form>
        </div>
        <div class="card-footer text-muted text-center">
            <small>By authorizing, you allow this application to access your data as described above.</small>
        </div>
    </div>
</div>
</body>
</html>
